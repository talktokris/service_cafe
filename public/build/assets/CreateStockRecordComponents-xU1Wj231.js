import{r as x,U as S,j as e,b as q}from"./app-BF4HM74z.js";function w({onClose:p,onSuccess:g,officeProfiles:b=[],stockItemSettings:j=[]}){const[s,r]=x.useState({headOfficeId:"",branchId:"",stockItemSettingId:"",itemType:"food",itemAmount:0,itemMassWeightKG:0,itemLiquidWeightML:0,quantity:0,itemAmountTotal:0,itemMassWeightKGTotal:0,itemLiquidWeightMLTotal:0,activeStatus:1}),[l,d]=x.useState({}),[o,m]=x.useState(!1),f=b.filter(t=>t.profileType==="HeadOffice"&&t.deleteStatus===0),y=b.filter(t=>t.profileType==="BranchOffice"&&t.deleteStatus===0),c=t=>{const{name:a,value:n,type:i,checked:u}=t.target;r(h=>({...h,[a]:i==="checkbox"?u:n})),l[a]&&d(h=>({...h,[a]:null}))},N=t=>{const a=t.target.value,n=j.find(i=>i.id==a);r(i=>({...i,stockItemSettingId:a,itemType:n?n.itemType:"food"}))},v=()=>{const t=parseFloat(s.quantity)||0,a=parseFloat(s.itemAmount)||0,n=parseFloat(s.itemMassWeightKG)||0,i=parseFloat(s.itemLiquidWeightML)||0;r(u=>({...u,itemAmountTotal:a*t,itemMassWeightKGTotal:n*t,itemLiquidWeightMLTotal:i*t}))};S.useEffect(()=>{v()},[s.quantity,s.itemAmount,s.itemMassWeightKG,s.itemLiquidWeightML]);const k=()=>{const t={};return s.headOfficeId||(t.headOfficeId="Head Office is required"),s.stockItemSettingId||(t.stockItemSettingId="Stock Item is required"),s.itemAmount<0&&(t.itemAmount="Item amount cannot be negative"),s.quantity<0&&(t.quantity="Quantity cannot be negative"),d(t),Object.keys(t).length===0},I=async t=>{if(t.preventDefault(),!!k()){console.log("Form data being submitted:",s),console.log("itemAmount:",s.itemAmount,"quantity:",s.quantity,"itemAmountTotal:",s.itemAmountTotal),m(!0);try{q.post("/stock-records",s,{onSuccess:a=>{var n;if((n=a.props.flash)!=null&&n.success&&console.log("Success message:",a.props.flash.success),console.log("Page props received:",a.props),console.log("stockRecord in props:",a.props.stockRecord),a.props.stockRecord)console.log("Using stockRecord from page props:",a.props.stockRecord),g(a.props.stockRecord);else{const i={id:Date.now(),...s,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};console.log("Using mock stock record:",i),g(i)}},onError:a=>{d(a)},onFinish:()=>{m(!1)}})}catch(a){console.error("Error creating stock record:",a),m(!1)}}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Create New Stock Record"}),e.jsx("button",{onClick:p,className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]})}),e.jsxs("form",{onSubmit:I,className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Office Selection"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Head Office *"})}),e.jsxs("select",{name:"headOfficeId",value:s.headOfficeId,onChange:c,className:`select select-bordered w-full ${l.headOfficeId?"select-error":""}`,children:[e.jsx("option",{value:"",children:"Select Head Office"}),f.map(t=>e.jsx("option",{value:t.id,children:t.companyName},t.id))]}),l.headOfficeId&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l.headOfficeId})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Branch Office"})}),e.jsxs("select",{name:"branchId",value:s.branchId,onChange:c,className:"select select-bordered w-full",children:[e.jsx("option",{value:"",children:"Select Branch Office (Optional)"}),y.map(t=>e.jsx("option",{value:t.id,children:t.companyName},t.id))]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Stock Item Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Stock Item *"})}),e.jsxs("select",{name:"stockItemSettingId",value:s.stockItemSettingId,onChange:N,className:`select select-bordered w-full ${l.stockItemSettingId?"select-error":""}`,children:[e.jsx("option",{value:"",children:"Select Stock Item"}),j.map(t=>e.jsxs("option",{value:t.id,children:[t.itemName," (",t.itemType,")"]},t.id))]}),l.stockItemSettingId&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l.stockItemSettingId})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Item Type"})}),e.jsx("input",{type:"text",value:s.itemType,className:"input input-bordered w-full bg-gray-100",readOnly:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Auto-filled based on selected stock item"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Item Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Item Amount (Rs)"})}),e.jsx("input",{type:"number",name:"itemAmount",value:s.itemAmount,onChange:c,className:`input input-bordered w-full ${l.itemAmount?"input-error":""}`,placeholder:"0.00",step:"0.01",min:"0"}),l.itemAmount&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l.itemAmount})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Mass Weight (KG)"})}),e.jsx("input",{type:"number",name:"itemMassWeightKG",value:s.itemMassWeightKG,onChange:c,className:"input input-bordered w-full",placeholder:"0",min:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Liquid Weight (ML)"})}),e.jsx("input",{type:"number",name:"itemLiquidWeightML",value:s.itemLiquidWeightML,onChange:c,className:"input input-bordered w-full",placeholder:"0",min:"0"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Quantity *"})}),e.jsx("input",{type:"number",name:"quantity",value:s.quantity,onChange:c,className:`input input-bordered w-full ${l.quantity?"input-error":""}`,placeholder:"0",min:"0"}),l.quantity&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l.quantity})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Calculated Totals"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Total Amount (Rs)"})}),e.jsx("input",{type:"number",value:s.itemAmountTotal,className:"input input-bordered w-full bg-gray-100",readOnly:!0,step:"0.01"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Total Mass Weight (KG)"})}),e.jsx("input",{type:"number",value:s.itemMassWeightKGTotal,className:"input input-bordered w-full bg-gray-100",readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Total Liquid Weight (ML)"})}),e.jsx("input",{type:"number",value:s.itemLiquidWeightMLTotal,className:"input input-bordered w-full bg-gray-100",readOnly:!0})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Status"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",name:"activeStatus",checked:s.activeStatus===1,onChange:t=>r(a=>({...a,activeStatus:t.target.checked?1:0})),className:"checkbox checkbox-primary mr-3"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Active Status"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-6 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:p,className:"btn btn-ghost",disabled:o,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:o,children:o?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"loading loading-spinner loading-sm mr-2"}),"Creating..."]}):"Create Stock Record"})]})]})]})})}export{w as default};
