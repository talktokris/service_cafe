import{a as I,r as p,j as e}from"./app-Cy0UIO-x.js";function L({table:r,order:s,onClose:j}){const{auth:h}=I().props,m=h==null?void 0:h.user,[c,x]=p.useState(!1),[d,y]=p.useState([]),[g,u]=p.useState(!0);p.useEffect(()=>{s&&s.id&&m&&B()},[s,m]);const B=async()=>{var t;try{u(!0);const n=await fetch(`/order-items?orderId=${s.id}&headOfficeId=${m.headOfficeId}&branchId=${m.branchId}&tableId=${r.id}`,{method:"GET",headers:{Accept:"application/json","X-CSRF-TOKEN":((t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.getAttribute("content"))||""}});if(n.ok){const i=await n.json();y(i.orderItems||[])}else console.error("Failed to fetch order items for receipt"),y([])}catch(n){console.error("Error fetching order items for receipt:",n),y([])}finally{u(!1)}},f=d.reduce((t,n)=>{const i=parseFloat(n.sellingPrice)||0,l=parseInt(n.quantity)||0;return t+i*l},0),b=d.reduce((t,n)=>{const i=parseFloat(n.taxAmount)||0;return t+i},0),v=f+b,a=t=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(t||0),C=()=>{x(!0);try{const t=document.getElementById("receipt-content"),n=`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Receipt - Table ${r.tableShortName}</title>
                    <style>
                        body { 
                            font-family: 'Courier New', monospace; 
                            font-size: 12px; 
                            margin: 20px;
                            line-height: 1.4;
                            width: 300px;
                        }
                        .receipt { margin: 0 auto; }
                    </style>
                </head>
                <body>
                    <div class="receipt">${t.innerHTML}</div>
                </body>
                </html>
            `,i=new Blob([n],{type:"text/html"}),l=URL.createObjectURL(i),o=document.createElement("a");o.href=l,o.download=`Receipt-Table-${r.tableShortName}-Order-${s.id}.html`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(l)}catch(t){console.error("Download Error:",t),alert("Failed to download receipt. Please try the Print option instead.")}finally{x(!1)}},k=()=>{x(!0);try{const t=document.getElementById("receipt-content"),n=window.open("","_blank");n.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Receipt - Table ${r.tableShortName}</title>
                    <style>
                        body { 
                            font-family: 'Courier New', monospace; 
                            font-size: 12px; 
                            margin: 20px;
                            line-height: 1.4;
                        }
                        .receipt { 
                            width: 300px; 
                            margin: 0 auto;
                        }
                        @media print {
                            body { margin: 0; }
                            .receipt { width: 100%; }
                        }
                    </style>
                </head>
                <body>
                    <div class="receipt">${t.innerHTML}</div>
                </body>
                </html>
            `),n.document.close(),n.focus(),setTimeout(()=>{n.print()},1e3)}catch(t){console.error("Print Error:",t),alert("Failed to print receipt. Please try again.")}finally{x(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-lg w-full max-h-[90vh] flex flex-col",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900",children:["Receipt - Table ",r.tableShortName]}),e.jsx("button",{onClick:j,className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]})}),e.jsx("div",{className:"p-6 flex-1 overflow-y-auto",children:g?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("span",{className:"loading loading-spinner loading-lg"}),e.jsx("p",{className:"text-gray-500 mt-2",children:"Loading receipt data..."})]}):d.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"No items found for this order"})}):e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsx("div",{className:"text-center text-sm text-gray-600 mb-4",children:"ðŸ“„ Receipt Preview"}),e.jsxs("div",{id:"receipt-content",className:"bg-white p-6 border rounded-lg",style:{width:"300px",minHeight:"400px",fontFamily:"Courier New, monospace",fontSize:"12px",lineHeight:"1.4",color:"black"},children:[e.jsxs("div",{style:{textAlign:"center",marginBottom:"20px"},children:[e.jsx("div",{style:{fontSize:"16px",fontWeight:"bold",marginBottom:"8px"},children:"SERVE CAFE"}),e.jsx("div",{style:{fontSize:"10px",marginBottom:"4px"},children:"14 Khumaltar, Lalitpur, Nepal"}),e.jsx("div",{style:{fontSize:"10px",marginBottom:"8px"},children:"Phone: +977 9766389515"}),e.jsx("div",{style:{borderBottom:"1px dashed #666",marginBottom:"8px"},children:"========================================"})]}),e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[e.jsx("span",{children:"Order ID:"}),e.jsxs("span",{children:["#",(s==null?void 0:s.id)||"N/A"]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[e.jsx("span",{children:"Table:"}),e.jsx("span",{children:(r==null?void 0:r.tableShortName)||"N/A"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"8px"},children:[e.jsx("span",{children:"Date & Time:"}),e.jsx("span",{style:{fontSize:"10px"},children:new Date().toLocaleString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})})]}),e.jsx("div",{style:{borderBottom:"1px dashed #666",marginBottom:"8px"},children:"========================================"})]}),e.jsxs("div",{style:{marginBottom:"16px"},children:[d.map((t,n)=>{var w,N;const i=((w=t.menu_item)==null?void 0:w.menuName)||((N=t.menuItem)==null?void 0:N.menuName)||"Unknown Item",l=parseFloat(t.sellingPrice)||0,o=parseInt(t.quantity)||0,T=l*o;return e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{style:{maxWidth:"180px",overflow:"hidden"},children:i}),e.jsx("span",{children:a(T)})]}),e.jsxs("div",{style:{fontSize:"10px",color:"#666",marginLeft:"8px"},children:[a(l)," x"," ",o]})]},t.id)}),e.jsx("div",{style:{borderBottom:"1px dashed #666",marginTop:"8px",marginBottom:"8px"},children:"========================================"})]}),e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[e.jsx("span",{children:"Subtotal:"}),e.jsx("span",{children:a(f)})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"8px"},children:[e.jsx("span",{children:"Tax:"}),e.jsx("span",{children:a(b)})]}),e.jsx("div",{style:{borderBottom:"1px dashed #666",marginBottom:"8px"},children:"========================================"}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontWeight:"bold",fontSize:"14px"},children:[e.jsx("span",{children:"TOTAL:"}),e.jsx("span",{children:a(v)})]}),e.jsx("div",{style:{borderBottom:"1px dashed #666",marginTop:"8px",marginBottom:"8px"},children:"========================================"})]}),e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[e.jsx("span",{children:"Payment Method:"}),e.jsx("span",{children:(s==null?void 0:s.paymentType)||"Cash"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[e.jsx("span",{children:"Amount Paid:"}),e.jsx("span",{children:a(v)})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"8px"},children:[e.jsx("span",{children:"Change:"}),e.jsx("span",{children:a(0)})]})]}),e.jsxs("div",{style:{textAlign:"center",fontSize:"10px",color:"#666"},children:[e.jsx("div",{style:{borderBottom:"1px dashed #666",marginBottom:"8px"},children:"========================================"}),e.jsx("div",{style:{marginBottom:"4px"},children:"Thank you for your visit!"}),e.jsx("div",{style:{marginBottom:"4px"},children:"Please come again"}),e.jsx("div",{children:"Visit us at: servecafe.com"})]})]})]})}),e.jsx("div",{className:"p-6 border-t border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:j,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",disabled:c,children:"Close"}),e.jsx("button",{onClick:C,className:"px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors flex items-center",disabled:c||g||d.length===0,children:c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b border-white mr-2"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Download HTML"]})}),e.jsx("button",{onClick:k,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors flex items-center",disabled:c||g||d.length===0,children:c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b border-white mr-2"}),"Printing..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"})}),"Print Receipt"]})})]})})]})})}export{L as default};
