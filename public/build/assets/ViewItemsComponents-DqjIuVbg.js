import{a as I,r as f,j as e}from"./app-CeALoAiy.js";function T({table:i,order:r,onClose:g,onAddItem:p,onEditItem:v,onDeleteItem:N,onMakePayment:w,onPrintReceipt:y,onRefresh:L,menuItems:C=[]}){const{auth:d}=I().props,l=d==null?void 0:d.user,[a,m]=f.useState([]),[k,j]=f.useState(!0);f.useEffect(()=>{console.log("ViewItemsComponents useEffect triggered:",{order:r,user:l,table:i}),r&&r.id&&l?x():console.log("Missing required data:",{hasOrder:!!r,hasOrderId:!!(r&&r.id),hasUser:!!l})},[r,l]);const x=async()=>{var s;try{j(!0),console.log("Fetching order items with params:",{orderId:r.id,headOfficeId:l.headOfficeId,branchId:l.branchId,tableId:i.id});const t=await fetch(`/order-items?orderId=${r.id}&headOfficeId=${l.headOfficeId}&branchId=${l.branchId}&tableId=${i.id}`,{method:"GET",headers:{Accept:"application/json","X-CSRF-TOKEN":((s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.getAttribute("content"))||""}});if(console.log("Response status:",t.status),t.ok){const n=await t.json();console.log("Fetched data:",n),m(n.orderItems||[])}else{const n=await t.text();console.error("Failed to fetch order items:",t.status,n),m([])}}catch(t){console.error("Error fetching order items:",t),m([])}finally{j(!1)}},h=a.reduce((s,t)=>{const n=parseFloat(t.sellingPrice)||0,c=parseInt(t.quantity)||0;return s+n*c},0),u=a.reduce((s,t)=>{const n=parseFloat(t.taxAmount)||0;return s+n},0),b=h+u;console.log("Calculation Debug:",{orderItems:a,subtotal:h,totalTax:u,finalTotal:b});const o=s=>{const t=parseFloat(s)||0;return new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(t)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-2 sm:p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full h-[85vh] sm:h-[80vh] max-h-[600px] flex flex-col",children:[e.jsx("div",{className:"p-4 sm:p-6 border-b border-gray-200 flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-lg sm:text-xl font-semibold text-gray-900",children:["Table ",i.tableShortName," - Order Items"]}),e.jsx("button",{onClick:g,className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsx("div",{className:"p-4 sm:p-6",children:e.jsx("div",{className:"mb-6",children:k?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("span",{className:"loading loading-spinner loading-lg"}),e.jsx("p",{className:"text-gray-500 mt-2",children:"Loading order items..."})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table table-zebra w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"S.N"}),e.jsx("th",{children:"Menu Items"}),e.jsx("th",{children:"Price"}),e.jsx("th",{children:"Qty"}),e.jsx("th",{children:"Tax"}),e.jsx("th",{children:"Sub Total"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:a.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"text-center py-8 text-gray-500",children:"No items in this order"})}):a.map((s,t)=>{var n,c;return e.jsxs("tr",{children:[e.jsx("td",{children:t+1}),e.jsx("td",{children:e.jsx("div",{className:"font-medium",children:((n=s.menu_item)==null?void 0:n.menuName)||((c=s.menuItem)==null?void 0:c.menuName)||"Unknown Item"})}),e.jsx("td",{children:e.jsx("span",{className:"font-medium text-green-600",children:o(s.sellingPrice)})}),e.jsx("td",{children:e.jsx("span",{className:"font-medium",children:s.quantity})}),e.jsx("td",{children:e.jsx("span",{className:"font-medium text-orange-600",children:o(s.taxAmount||0)})}),e.jsx("td",{children:e.jsx("span",{className:"font-medium text-blue-600",children:o(s.sellingPrice*s.quantity)})}),e.jsx("td",{children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>v(s,()=>x()),className:"btn btn-ghost btn-xs text-blue-600 hover:bg-blue-50",title:"Edit Item",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsx("button",{onClick:()=>N(s,()=>x()),className:"btn btn-ghost btn-xs text-red-600 hover:bg-red-50",title:"Delete Item",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})})]},s.id)})})]})})})})}),e.jsxs("div",{className:"border-t border-gray-200 flex-shrink-0 bg-gray-50 rounded-b-lg",children:[a.length>0&&e.jsx("div",{className:"px-4 sm:px-6 pt-4 pb-2 border-b border-gray-300",children:e.jsx("div",{className:"flex flex-col sm:flex-row justify-center items-center gap-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-evenly items-center w-full max-w-5xl gap-4 sm:gap-0",children:[e.jsxs("div",{className:"flex justify-between sm:justify-center items-center w-full sm:flex-1",children:[e.jsx("span",{className:"text-gray-600 text-sm font-medium mr-2",children:"Sub Total:"}),e.jsx("span",{className:"font-semibold text-lg",children:o(h)})]}),e.jsxs("div",{className:"flex justify-between sm:justify-center items-center w-full sm:flex-1",children:[e.jsx("span",{className:"text-gray-600 text-sm font-medium mr-2",children:"Tax:"}),e.jsx("span",{className:"font-semibold text-lg text-orange-600",children:o(u)})]}),e.jsxs("div",{className:"flex justify-between sm:justify-center items-center w-full sm:flex-1",children:[e.jsx("span",{className:"text-gray-800 text-base font-bold mr-2",children:"Total:"}),e.jsx("span",{className:"font-bold text-xl text-green-600",children:o(b)})]})]})})}),e.jsx("div",{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-3 sm:gap-0",children:[e.jsxs("button",{onClick:p,className:"btn btn-sm sm:btn-md bg-green-600 hover:bg-green-700 text-white w-full sm:w-auto",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Add Item"]}),e.jsxs("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3 w-full sm:w-auto",children:[e.jsxs("button",{onClick:w,className:"btn btn-sm sm:btn-md bg-blue-600 hover:bg-blue-700 text-white w-full sm:w-auto",disabled:a.length===0,children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"})}),"Make Payment"]}),e.jsxs("button",{onClick:y,className:"btn btn-sm sm:btn-md bg-gray-600 hover:bg-gray-700 text-white w-full sm:w-auto",disabled:a.length===0,children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"})}),"Print Receipt"]})]})]})})]})]})})}export{T as default};
