import{r as l,u as H,j as e,H as W}from"./app-BF4HM74z.js";import U from"./AdminDashboardLayout-cKA688Yo.js";import"./AdminHeader-BeuGWkle.js";import"./AdminFooter-BCe7s_gY.js";import"./AdminSidebar-K_qzx2q6.js";const A=`
    .scrollbar-hide {
        -ms-overflow-style: none;
        scrollbar-width: none;
    }
    .scrollbar-hide::-webkit-scrollbar {
        display: none;
    }
`;function G({auth:h,todayOrders:a=[],filters:F={},availableDates:T=[]}){const O=h==null?void 0:h.user;console.log("TodayOTPView initialized with:",{todayOrdersCount:a.length,availableDates:T.map(t=>({value:t.value,label:t.label,is_today:t.is_today}))});const[i,g]=l.useState(""),[u,d]=l.useState(a),[c,S]=l.useState(new Set),[b,f]=l.useState(new Set),{data:V,setData:B,get:_,processing:m}=H({search:""}),[p,x]=l.useState(!1);l.useEffect(()=>{console.log("Orders data updated from backend:",{ordersCount:a.length}),d(a)},[a]),l.useEffect(()=>{if(!i.trim())d(a);else{const t=a.filter(s=>{var o,n,v,y,w,N,k,L,C;const r=i.toLowerCase();return s.id.toString().includes(r)||((o=s.txn_otp)==null?void 0:o.includes(r))||((v=(n=s.memberUser)==null?void 0:n.first_name)==null?void 0:v.toLowerCase().includes(r))||((w=(y=s.memberUser)==null?void 0:y.last_name)==null?void 0:w.toLowerCase().includes(r))||((k=(N=s.memberUser)==null?void 0:N.email)==null?void 0:k.toLowerCase().includes(r))||((C=(L=s.memberUser)==null?void 0:L.phone)==null?void 0:C.includes(r))});d(t)}},[i,a]);const P=()=>{x(!0),_("/today-otp",{preserveState:!1,replace:!1,onStart:()=>x(!0),onFinish:()=>x(!1),onError:t=>{console.error("Error reloading OTP orders:",t),x(!1)}})},D=()=>{g("")},M=t=>{const s=new Set(c);s.has(t)?s.delete(t):s.add(t),S(s)},z=(t,s)=>{navigator.clipboard.writeText(t);const r=new Set(b);r.add(s),f(r),setTimeout(()=>{f(o=>{const n=new Set(o);return n.delete(s),n})},3e3)};l.useEffect(()=>{console.log("Orders data updated from backend:",{ordersCount:a.length,orders:a.map(t=>({id:t.id,created_at:t.created_at,date:new Date(t.created_at).toLocaleDateString()}))}),d(a)},[a]);const j=t=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(t||0);return e.jsxs(U,{title:"OTP Orders (Past 3 Days) - Serve Cafe",user:O,children:[e.jsx(W,{title:"OTP Orders (Past 3 Days)"}),e.jsx("style",{dangerouslySetInnerHTML:{__html:A}}),e.jsx("div",{className:"mb-4",children:e.jsx("div",{className:"bg-white rounded-lg p-4 border border-gray-200 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"OTP Orders (Past 3 Days)"}),e.jsx("p",{className:"text-sm text-gray-600",children:"All OTP transactions from the past 3 days"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:u.length}),e.jsxs("div",{className:"text-sm text-gray-500",children:[i?"Filtered":"Total"," Orders"]})]})]})})}),e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:"bg-white rounded-lg p-4 border border-gray-200 shadow-sm",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{className:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",value:i,onChange:t=>g(t.target.value),placeholder:"Search by Order ID, OTP, member name, or email...",className:"w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"})]}),i&&e.jsx("button",{onClick:D,className:"px-4 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors text-sm font-medium",children:"Clear"}),e.jsx("button",{onClick:P,disabled:p||m,className:"px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 focus:ring-2 focus:ring-green-500 focus:ring-offset-2 disabled:opacity-50 transition-colors text-sm font-medium flex items-center",children:p||m?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b border-white mr-2"}),"Loading..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Load Data"]})})]})})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden relative",children:[(p||m)&&e.jsx("div",{className:"absolute inset-0 bg-white bg-opacity-75 flex items-center justify-center z-10",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"text-gray-600 font-medium",children:m?"Searching...":"Loading orders..."})]})}),u.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("svg",{className:"w-16 h-16 mx-auto mb-4 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),e.jsx("p",{className:"text-lg font-medium text-gray-900 mb-2",children:i?"No matching orders found":"No OTP orders found"}),e.jsx("p",{className:"text-gray-500",children:i?"Try adjusting your search terms":"Orders with OTP from the past 3 days will appear here"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Order Details"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Member Info"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"OTP"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:u.map(t=>{var s,r,o,n;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:["Order #",t.id]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Table:"," ",((s=t.table)==null?void 0:s.tableShortName)||"N/A"]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[new Date(t.created_at).toLocaleDateString()," ","at"," ",new Date(t.created_at).toLocaleTimeString()]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.memberUser&&`${t.memberUser.first_name||""} ${t.memberUser.last_name||""}`.trim()||"Walking Customer"}),e.jsx("div",{className:"text-sm text-gray-500",children:((r=t.memberUser)==null?void 0:r.email)||"No email"}),e.jsx("div",{className:"text-sm text-gray-500",children:((o=t.memberUser)==null?void 0:o.phone)||"No phone"}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium mt-1 ${t.free_paid_member_status===1?"bg-emerald-100 text-emerald-800":"bg-gray-100 text-gray-800"}`,children:t.free_paid_member_status===1?"ðŸ’Ž Paid":"ðŸ†“ Free"})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center space-x-2 relative",children:[b.has(t.id)&&e.jsxs("div",{className:"absolute -top-10 left-0 bg-green-600 text-white text-xs px-2 py-1 rounded shadow-lg z-10 animate-pulse",children:["OTP copied to clipboard!",e.jsx("div",{className:"absolute top-full left-3 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-green-600"})]}),e.jsx("div",{className:"text-lg font-mono font-bold text-blue-600 bg-blue-50 px-3 py-1 rounded-lg",children:c.has(t.id)?t.txn_otp:"â€¢".repeat(((n=t.txn_otp)==null?void 0:n.length)||6)}),e.jsx("button",{onClick:()=>M(t.id),className:"p-1 text-gray-500 hover:text-blue-600 transition-colors",title:c.has(t.id)?"Hide OTP":"Show OTP",children:c.has(t.id)?e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21"})}):e.jsxs("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})}),e.jsx("button",{onClick:()=>z(t.txn_otp,t.id),className:"p-1 text-gray-500 hover:text-green-600 transition-colors",title:"Copy OTP",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:j(t.sellingPrice)}),t.discountAmount>0&&e.jsxs("div",{className:"text-sm text-red-600",children:["Discount:"," ",j(t.discountAmount)]})]})]},t.id)})})]})})]})]})}export{G as default};
